# 数据结构与对象

## 简单动态字符串

简单动态字符串（simple dynamic string, SDS），是由 Redis 构建的一种抽象类型。**Redis 的默认字符串表示就是这个简单动态字符串**，而 c 语言的传统字符串只被用在了一些无须对字符串值进行修改的地方当作字符串字面量，如：打印日志。

### SDS 的定义

```c
struct sdshdr {
    // 记录 buf 数组中已使用字节的数量
    // 等于 SDS 所保存字符串的长度
    int len;
    // 记录 buf 数组中未使用字节的数量
    int free;
    // 字节数组，用于保存字符串
    char buf[];
};
```

SDS 遵循 c 语言字符串以空字符结尾的惯例，保存空字符的 1 字节的空间不计算在 SDS 的 len 属性中。额外分配 1 字节空间、添加空字符到字符串末尾等操作，都是由 SDS 函数自动完成。

### SDS 的优点

#### 获取长度的复杂度为常数级别

因为 SDS 中的 len 属性记录了本身的长度，所以**获取长度的复杂度为O(1)**。而 c 语言字符串获取长度的复杂度是O(n)，因为只有遍历到结尾的空字符时，才能知道长度。

#### 不存在缓存溢出的问题

当需要对 SDS 进行修改时，会先检查空间是否满足修改的需求。如果不满足，会自动将空间扩展至执行所需的大小，然后才执行修改操作。所以既不需要手动修改空间大小，也不会出现溢出问题。

#### 减少内存重分配次数

**SDS 通过未使用空间减少因修改字符串造成的内存重分配次数**，在 SDS 中，buf 数组的长度不一定就是字符数量加1，数组里面可能包含未使用的字节，这些字节的数量由 SDS 的 free 属性记录。通过未使用空间，SDS 实现了**空间预分配**和**惰性空间释放**两种优化策略。

##### 空间预分配

主要用于优化 SDS 的增长操作。当需要对 SDS 进行空间扩展时，除了分配修改所必需的空间，还会分配额外的空间。额外分配的空间由以下公式决定：





## 链表

## 字典

## 跳跃表

## 整数集合

## 压缩列表

## 对象





